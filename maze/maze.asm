	ORG	#D000

	LD	A,(IY+#4E)
	CP	#80
	JR	NZ,JD01A
	LD	(IY+#4D),A
	LD	(IY+#4E),#C0
	LD	HL,#D0B8
	LD	DE,#C800
	LD	BC,#0800
	LDIR
	RET

JD01A:	LD	C,#FF
	LD	DE,#FFFF
	CALL	JD078
	LD	C,A
	BIT	6,(IY-#01)
	JR	Z,JD02F
	CALL	CD087
	LD	C,A
	JR	JD03B
JD02F:	LD	A,(IY+#3B)
	CP	#04
	JR	NC,JD03B
	CALL	CD087
	JR	JD03E
JD03B:	CALL	JD078
JD03E:	LD	D,A
	CALL	JD078
	LD	E,A
	CALL	JD078
	LD	(DD0B6),DE
	LD	(DD0B5),A
	LD	A,C
	LD	(DD06C),A
	LD	DE,#C800
	LD	IX,DD0B5
	LD	B,#03
JD05A:	LD	A,(IX+#00)
	INC	IX
	PUSH	BC
	PUSH	DE
	CALL	CD08F
	EX	DE,HL
	POP	DE
	LDIR
	POP	BC
	DJNZ	JD05A
	LD	A,#00
	CALL	CD08F
	PUSH	DE
	POP	IX
	LD	(IY+#4D),#07
	RET

JD078:	CALL	#8500
	AND	#07
	CP	E
	JR	Z,JD078
	CP	D
	JR	Z,JD078
	CP	C
	JR	Z,JD078
	RET


CD087:	CALL	#8500
	AND	#01
	ADD	A,#08
	RET


CD08F:	LD	DE,#D0B8
	LD	HL,DD0A1
	INC	A
JD096:	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	DEC	A
	RET	Z
	EX	DE,HL
	ADD	HL,BC
	EX	DE,HL
	JR	JD096
DD0A1:	LD	C,A
	NOP
	LD	C,A
	NOP
	ADD	A,B
	NOP
	ADC	A,E
	NOP
	LD	L,D
	NOP
	ADD	A,A
	NOP
	LD	D,A
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
	NOP
DD0B5:	NOP
DD0B6:	NOP

	END
